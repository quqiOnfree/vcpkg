diff --git a/CMakeLists.txt b/CMakeLists.txt
index 85ec6d2..ac49476 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -609,16 +609,21 @@ IF(UNIX)
 ENDIF()
 SET(${LIBRARY_NAME}_OBJECTS $<TARGET_OBJECTS:${LIBRARY_NAME}_obj>)
 
+SET(STATIC_LIBRARY_NAME ${LIBRARY_NAME})
+
 IF(WIN32 AND NOT MINGW)
+  IF(BUILD_SHARED_LIBS)
   ADD_LIBRARY(${LIBRARY_NAME} SHARED ${CMAKE_SOURCE_DIR}/src/maconncpp.rc ${${LIBRARY_NAME}_OBJECTS} ${CMAKE_SOURCE_DIR}/src/maconncpp.def)
-  ADD_LIBRARY(${STATIC_LIBRARY_NAME} STATIC ${${LIBRARY_NAME}_OBJECTS} ${CMAKE_SOURCE_DIR}/src/maconncpp.rc)
 
   TARGET_COMPILE_DEFINITIONS(${LIBRARY_NAME}_obj PRIVATE "MARIADB_EXPORTED=__declspec(dllexport)")
 
   TARGET_COMPILE_DEFINITIONS(${LIBRARY_NAME} PRIVATE "MARIADB_EXPORTED=__declspec(dllexport)")
   TARGET_COMPILE_DEFINITIONS(${LIBRARY_NAME} INTERFACE "MARIADB_EXPORTED=__declspec(dllimport)")
 
+  ELSE()
+  ADD_LIBRARY(${STATIC_LIBRARY_NAME} STATIC ${${LIBRARY_NAME}_OBJECTS} ${CMAKE_SOURCE_DIR}/src/maconncpp.rc)
   TARGET_COMPILE_DEFINITIONS(${STATIC_LIBRARY_NAME} PUBLIC MARIADB_STATIC_LINK)
+  ENDIF()
 ELSE()
   # Xcode doesn't support targets that have only object files,
   # so let's add an empty file to keep Xcode happy
@@ -627,25 +632,34 @@ ELSE()
     SET(EMPTY_FILE ${CMAKE_BINARY_DIR}/empty.cpp)
   ENDIF()
   #  MESSAGE(STATUS "Version script: ${CMAKE_SOURCE_DIR}/src/maconncpp.def")
+  IF(BUILD_SHARED_LIBS)
   ADD_LIBRARY(${LIBRARY_NAME} SHARED ${${LIBRARY_NAME}_OBJECTS} ${EMPTY_FILE})
+  ELSE()
   ADD_LIBRARY(${STATIC_LIBRARY_NAME} STATIC ${${LIBRARY_NAME}_OBJECTS} ${EMPTY_FILE})
+  ENDIF()
 
   IF(APPLE)
+    IF(BUILD_SHARED_LIBS)
     SET_TARGET_PROPERTIES(${LIBRARY_NAME} PROPERTIES LINK_FLAGS "-Wl"
                                      INSTALL_RPATH_USE_LINK_PATH 0
                                      BUILD_WITH_INSTALL_RPATH 1
                                      XCODE_ATTRIBUTE_ENABLE_HARDENED_RUNTIME YES
                                      XCODE_ATTRIBUTE_OTHER_CODE_SIGN_FLAGS "--timestamp -f"
                                      INSTALL_RPATH "${MAODBC_INSTALL_RPATH}")
+    ELSE()
     SET_TARGET_PROPERTIES(${STATIC_LIBRARY_NAME} PROPERTIES 
                                      INSTALL_RPATH_USE_LINK_PATH 0
                                      BUILD_WITH_INSTALL_RPATH 1
                                      XCODE_ATTRIBUTE_ENABLE_HARDENED_RUNTIME YES
                                      XCODE_ATTRIBUTE_OTHER_CODE_SIGN_FLAGS "--timestamp -f"
                                      INSTALL_RPATH "${MAODBC_INSTALL_RPATH}")
+    ENDIF()
     IF(WITH_SIGNCODE)
+      IF(BUILD_SHARED_LIBS)
       SET_TARGET_PROPERTIES(${LIBRARY_NAME} PROPERTIES XCODE_ATTRIBUTE_CODE_SIGN_IDENTITY "Developer ID Application: ${DEVELOPER_ID}")
+      ELSE()
       SET_TARGET_PROPERTIES(${STATIC_LIBRARY_NAME} PROPERTIES XCODE_ATTRIBUTE_CODE_SIGN_IDENTITY "Developer ID Application: ${DEVELOPER_ID}")
+      ENDIF()
     ELSE()
       SET_TARGET_PROPERTIES(${LIBRARY_NAME} PROPERTIES XCODE_ATTRIBUTE_CODE_SIGN_IDENTITY "")
       SET_TARGET_PROPERTIES(${STATIC_LIBRARY_NAME} PROPERTIES XCODE_ATTRIBUTE_CODE_SIGN_IDENTITY "")
@@ -655,14 +669,17 @@ ELSE()
   ENDIF()
 ENDIF()
 
+IF(BUILD_SHARED_LIBS)
 TARGET_LINK_LIBRARIES(${LIBRARY_NAME} PRIVATE ${PLATFORM_DEPENDENCIES} unofficial::libmariadb)
-TARGET_LINK_LIBRARIES(${STATIC_LIBRARY_NAME} PRIVATE unofficial::libmariadb)
 TARGET_INCLUDE_DIRECTORIES(${LIBRARY_NAME}
   INTERFACE
     $<INSTALL_INTERFACE:include>/${LIBRARY_NAME})
+ELSE()
+TARGET_LINK_LIBRARIES(${STATIC_LIBRARY_NAME} PRIVATE unofficial::libmariadb)
 TARGET_INCLUDE_DIRECTORIES(${STATIC_LIBRARY_NAME}
   INTERFACE
     $<INSTALL_INTERFACE:include>/${LIBRARY_NAME})
+ENDIF()
 
 # MINGW Specific includes and linking
 IF(0)
@@ -718,7 +735,7 @@ ELSE()
     #MESSAGE(STATUS "Configuring to generate PKG package")
     #ADD_SUBDIRECTORY(osxinstall)
   ENDIF()
-  install(TARGETS ${LIBRARY_NAME} ${STATIC_LIBRARY_NAME}
+  install(TARGETS ${LIBRARY_NAME}
           EXPORT unofficial-${LIBRARY_NAME}-targets
           LIBRARY DESTINATION lib
           ARCHIVE DESTINATION lib
